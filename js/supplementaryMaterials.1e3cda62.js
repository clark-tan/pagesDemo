(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["supplementaryMaterials","chunk-ce2dfc38","chunk-75e40762"],{2909:function(t,e,a){"use strict";a.d(e,"a",(function(){return l}));var n=a("6b75");function i(t){if(Array.isArray(t))return Object(n["a"])(t)}a("a4d3"),a("e01a"),a("d28b"),a("a630"),a("d3b7"),a("3ca3"),a("ddb0");function s(t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}var o=a("06c5");function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function l(t){return i(t)||s(t)||Object(o["a"])(t)||r()}},"3d4f":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-layout",{staticClass:"smLayout"},[a("div",{staticClass:"my-tab-head"},[a("a-tabs",{on:{change:t.handleTabsChange},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:"activeKey"}},[a("a-tab-pane",{key:"0",attrs:{tab:"待补充材料"}}),a("a-tab-pane",{key:"1",attrs:{tab:"已补充材料"}})],1)],1),a("div",{staticClass:"my-spin"},[a("a-spin",{attrs:{tip:"正在加载...",spinning:t.onSpinning}},[t.listData&&t.listData.length>0?t._l(t.listData,(function(e,n){return a("div",{key:n},[a("a-card",{attrs:{title:"",bordered:!1,size:"small"}},[a("a-descriptions",{attrs:{title:"",size:"small",bordered:""}},[t._l(e,(function(e,n){return["XYBCCL"!=e.key&&"CODE"!=e.key&&"ZLZT"!=e.key?a("a-descriptions-item",{key:n,attrs:{label:e.label,span:e.span}},[t._v(t._s(e.value||"-"))]):t._e(),"ZLZT"==e.key?a("a-descriptions-item",{key:n,attrs:{label:e.label,span:e.span}},["已接收"==e.value?[a("a-tag",{attrs:{color:"#87d068"}},[t._v("已接收")])]:t._e(),"待接收"==e.value?[a("a-tag",{attrs:{color:"#FF8800"}},[t._v("待接收")])]:t._e()],2):t._e()]})),t._l(e,(function(i,s){return["XYBCCL"==i.key?a("a-descriptions-item",{key:s,attrs:{label:i.label,span:3}},[a("a",{on:{click:function(a){return t.showModal(e,n)}}},[t._v(t._s(t.fixCL(i)||"-"))])]):t._e()]}))],2),a("div",{staticClass:"buttonDiv"},["0"==t.activeKey?a("a-button",{attrs:{type:"primary",size:"small"},on:{click:function(a){return t.showModal(e,n)}}},[t._v("上传材料")]):t._e(),t._l(e,(function(i,s){return["ZLZT"==i["key"]&&"待接收"==i["value"]&&"1"==t.activeKey?a("a-button",{key:s,attrs:{type:"primary",size:"small"},on:{click:function(a){return t.handleWithdraw(e,n)}}},[t._v("撤回，重新上传")]):t._e()]}))],2)],1)],1)})):a("s-empty")],2)],1),a("a-modal",{attrs:{title:t.programTitle,visible:t.materialsBox,"confirm-loading":t.confirmLoading,maskClosable:!1,width:"900px"},on:{cancel:t.handleCancel}},[a("template",{slot:"footer"},["0"==t.activeKey?[a("a-button",{key:"back",attrs:{disabled:t.isUploading},on:{click:t.handleSave}},[t._v("暂存")]),a("a-button",{key:"submit",attrs:{type:"primary",disabled:t.isUploading},on:{click:t.handleOk}},[t._v("提交")])]:[t._v(t._s(null))]],2),a("a-descriptions",{attrs:{title:"",size:"small",bordered:""}},[t._l(t.materialsBoxItems,(function(e,n){return["CODE"!=e.key&&"XYBCCL"!=e.key?a("a-descriptions-item",{key:n,attrs:{label:e.label,span:e.span}},[t._v(t._s(e.value))]):t._e()]}))],2),t._l(t.materialsBoxItems,(function(e,n){return a("div",{key:n},["XYBCCL"==e.key?[a("p",{staticStyle:{"text-align":"center"}},[t._v("需要补充的材料")]),a("SmTable",{ref:"smtable",refInFor:!0,attrs:{tableData:t.tableData,disabled:"1"==t.activeKey},on:{uploadStatusChange:t.handleUploadStatusChange}})]:t._e()],2)}))],2),a("a-back-top")],1)},i=[],s=(a("a15b"),a("d81d"),a("5530")),o=a("2f62"),r=a("ff03"),l=a("b405"),u={name:"SupplementaryMaterials",components:{SmTable:r["default"],SEmpty:l["default"]},props:{},data:function(){return{tableData:{columns:[{label:"材料名称",key:"CLMC",type:"texgt"},{label:"备注说明",key:"BZSM",type:"texgt"},{label:"上传文件名",key:"NAME",type:"texgt"},{label:"上传文件地址",key:"ZCURL",type:"texgt"}],hideColumns:["NAME","ZCURL"],rowsList:[]},isUploading:!1,activeKey:"0",materialsBoxItems:{},onSpinning:!1,listData:[],programTitle:"上传附件",materialsBox:!1,confirmLoading:!1,submitData:{},savedData:{}}},computed:Object(s["a"])({},Object(o["c"])({user:"userInfo"})),created:function(){},mounted:function(){this.QueryEntrust()},methods:{TemporaryMaterialsList:function(){var t=this;this.$WebApi.supplementaryMaterials["TemporaryMaterialsList"]({data:JSON.stringify(this.savedData)}).then((function(e){t.QueryEntrust()})).catch((function(t){}))},SupplMaterialsList:function(){var t=this;this.$WebApi.supplementaryMaterials["SupplMaterialsList"]({data:JSON.stringify(this.submitData)}).then((function(e){t.materialsBox=!1,t.confirmLoading=!1,t.$message.success("提交成功！！"),t.QueryEntrust()})).catch((function(t){}))},QueryEntrust:function(){var t=this;this.listData=[],this.onSpinning=!0,this.$WebApi.supplementaryMaterials["GetSupplyMaterialList"]({userid:this.user.userID,type:this.activeKey}).then((function(e){var a=t.handleBusiOnProData(e);t.listData=a,t.onSpinning=!1})).catch((function(e){t.onSpinning=!1}))},RevokeSupplyMaterial:function(t){var e=this;this.onSpinning=!0,this.$WebApi.supplementaryMaterials["RevokeSupplyMaterial"]({code:t}).then((function(t){e.QueryEntrust(),e.onSpinning=!1})).catch((function(t){e.onSpinning=!1}))},handleBusiOnProData:function(t){var e=[],a=t["columns"],n=t["rowsList"];return e=n.map((function(t,e){var n=[],i=!1;a.map((function(e,a){"BCFS"===e.key&&"现场送过来"===t[e.key]&&(i=!0),n.push({key:e.key,value:t[e.key],label:e.label,type:e.type,span:1.5})})),i||n.map((function(t,e){"LXR"!==t.key&&"LXDH"!==t.key&&"JSDZ"!==t.key||delete n[e]}));var s=Window._.compact(n);return s})),e},showModal:function(t,e){var a=this;this.$set(this.tableData,"rowsList",[]),t.map((function(t,e){"XYBCCL"===t.key&&a.$set(a.tableData,"rowsList",t.value)})),this.materialsBoxItems=t,this.materialsBox=!0},handleOk:function(t){var e=!0,a=JSON.parse(JSON.stringify(this.$refs.smtable[0].data));if(a.map((function(t){delete t.showdata,delete t.action,delete t.index,t.NAME&&0===t.NAME.length&&(e=!1)})),e){var n={};this.materialsBoxItems.map((function(t,e){n[t["key"]]=t["value"]})),n["XYBCCL"]=a,this.submitData=n,this.SupplMaterialsList(),this.confirmLoading=!0}else this.$message.warning("请上传所有材料！")},handleCancel:function(t){this.materialsBox=!1},fixCL:function(t){var e=t.value.map((function(t,e){return t.CLMC}));return e.join(";")},handleSave:function(){var t=this,e=JSON.parse(JSON.stringify(this.$refs.smtable[0].data));e.map((function(t){delete t.showdata,delete t.action,delete t.index}));var a={};this.materialsBoxItems.map((function(t,n){"CODE"===t["key"]&&(a[t["key"]]=t["value"]),"XYBCCL"===t["key"]&&(a[t["key"]]=e)})),this.savedData=a,this.TemporaryMaterialsList(),this.confirmLoading=!0,setTimeout((function(){t.materialsBox=!1,t.confirmLoading=!1,t.$message.success("暂存成功！！")}),2e3)},handleTabsChange:function(t){this.QueryEntrust()},handleWithdraw:function(t,e){var a,n=this;t.map((function(t,e){"CODE"===t["key"]&&(a=t["value"])})),this.$confirm({title:"请确认是否撤回已补充材料？",content:"若确认撤回，该补充材料任务放回到“待补充材料页面”",onOk:function(){n.RevokeSupplyMaterial(a)},onCancel:function(){}})},handleUploadStatusChange:function(t){this.isUploading=t}}},c=u,d=(a("c06a"),a("2877")),p=Object(d["a"])(c,n,i,!1,null,"111eb0fa",null);e["default"]=p.exports},"7fed":function(t,e,a){"use strict";a("a7e8")},a7e8:function(t,e,a){},b405:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("a-empty",{attrs:{image:t.imgPath,"image-style":{height:t.height}}},[a("span",{attrs:{slot:"description"},slot:"description"})])},i=[],s={name:"SEmpty",components:{},props:{height:{default:"100%",type:String}},data:function(){return{imgPath:a("f3f6")}},computed:{},watch:{},created:function(){},methods:{}},o=s,r=a("2877"),l=Object(r["a"])(o,n,i,!1,null,"138622d4",null);e["default"]=l.exports},c06a:function(t,e,a){"use strict";a("c864")},c864:function(t,e,a){},f3f6:function(t,e,a){t.exports=a.p+"img/empty.eb1f7831.png"},ff03:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("a-table",{attrs:{size:"small",columns:t.columns,"data-source":t.data?t.data:[],loading:t.tableLoading,pagination:!1,rowKey:function(t){return t["index"]},expandedRowKeys:t.expandedRowKeys},on:{expandedRowsChange:t.expandedRowsChange},scopedSlots:t._u([{key:"expandedRowRender",fn:function(e){return[e.showdata&&e.showdata.length>0?[t._l(e.showdata,(function(n,i){return[a("a-row",{key:i,style:{marginBottom:"4px",textAlign:"left"}},[a("a-col",{attrs:{span:"8"}},[a("a",{style:{marginRight:"10px"},attrs:{href:n.url,target:"_blank"}},[t._v(t._s(n.name))])]),a("a-col",{attrs:{span:"4"}},[0==t.disabled?a("a-button",{attrs:{type:"danger",size:"small",icon:"delete"},on:{click:function(a){return t.deleteFile(e,i)}}}):t._e()],1)],1)]}))]:a("a-empty")]}},{key:"action",fn:function(e,n){return[[a("a-upload",{attrs:{name:"file",multiple:!0,action:t.MaterialUpload,"file-list":n.action,showUploadList:!1,disabled:1==t.disabled},on:{change:function(e){return t.handleChange(e,n)}}},[a("a-button",{attrs:{size:"small",type:"primary",icon:"upload",disabled:1==t.disabled}},[t._v("点这里上传")])],1)]]}}])})],1)},i=[],s=(a("4de4"),a("d81d"),a("45fc"),a("a434"),a("b0c0"),a("2909")),o=a("5530"),r=a("377c"),l={name:"SmTable",components:{},props:{tableData:{default:function(){},type:Object,required:!0},disabled:{default:!1,type:Boolean,required:!0}},data:function(){return{MaterialUpload:r["K"],expandedRowKeys:[],data:[],columns:[],tableLoading:!1,isUploading:!1}},computed:{},watch:{tableData:{handler:function(t,e){this._.isEmpty(t)||(this.tableLoading=!0,this.columns=this.getTableColumn(this.tableData),this.data=this.getTableData(this.tableData),this.tableLoading=!1)},deep:!0}},created:function(){},mounted:function(){this.columns=this.getTableColumn(this.tableData),this.data=this.getTableData(this.tableData)},methods:{getTableColumn:function(t){if(this._.isEmpty(t))return{};var e=t.columns,a=t.hideColumns,n=e.filter((function(t){return!a.some((function(e){return e===t.key}))})),i=n.map((function(t,e){return{dataIndex:t["key"],key:t["key"],title:t["label"],scopedSlots:{customRender:t["key"]}}}));return i.push({dataIndex:"action",key:"action",title:"操作",scopedSlots:{customRender:"action"}}),i},getTableData:function(t){var e=this,a=[];if(this.expandedRowKeys=[],this._.isEmpty(t))a=[];else{var n=t.rowsList;a=n.map((function(t,a){var n=[],i=[],s=[];for(var r in t)"NAME"===r&&(n=t[r],t[r]&&t[r].length>0&&e.expandedRowKeys.push(a)),"ZCURL"===r&&(i=t[r]);return n.map((function(t,e){s.push({name:t,url:i[e]})})),Object(o["a"])(Object(o["a"])({},t),{},{index:a,showdata:s,action:[]})}))}return a},handleChange:function(t,e){var a=Object(s["a"])(t.fileList),n=t.file;n.status&&"removed"===n.status||(this.isUploading=!0,this.$emit("uploadStatusChange",this.isUploading)),n.response&&"done"===n.status&&(0===n.response.code?(e.showdata.push({name:n.response.data[0].fileName,url:n.response.data[0].fileUrl}),e.NAME.push(n.response.data[0].fileName),e.ZCURL.push(n.response.data[0].fileUrl),this.expandedRowKeys.push(e.index)):this.$message.error("文件上传失败！"),this.isUploading=!1,this.$emit("uploadStatusChange",this.isUploading)),"error"===n.status&&(this.$message.error("文件: "+n.name+"上传失败！"),this.isUploading=!1,this.$emit("uploadStatusChange",this.isUploading)),a=a.map((function(t){return t.response&&"done"===t.status&&t.response.code,t})),e.action=a},expandedRowsChange:function(t){this.expandedRowKeys=t},deleteFile:function(t,e){t.showdata.splice(e,1),t.NAME.splice(e,1),t.ZCURL.splice(e,1),t.NAME&&0===t.NAME.length&&this.expandedRowKeys.splice(t.index,1,null)}}},u=l,c=(a("7fed"),a("2877")),d=Object(c["a"])(u,n,i,!1,null,"68327b89",null);e["default"]=d.exports}}]);